"""
아이템 데이터베이스 모듈
JSON 파일에서 아이템 ID와 이름 매핑을 로드
"""

import json
import os
from typing import Dict


class ItemDatabase:
    """아이템 데이터베이스 클래스"""
    
    def __init__(self, json_file_path: str = "items_list.json"):
        self.json_file_path = json_file_path
        self._items: Dict[int, str] = {}
        self._load_items_from_json()
    
    def _load_items_from_json(self):
        """JSON 파일에서 아이템 데이터 로드"""
        try:
            if os.path.exists(self.json_file_path):
                with open(self.json_file_path, 'r', encoding='utf-8') as f:
                    items_json = json.load(f)
                    # 문자열 키를 정수로 변환
                    self._items = {int(k): v for k, v in items_json.items()}
                print(f"아이템 {len(self._items)}개를 {self.json_file_path}에서 로드했습니다.")
            else:
                print(f"경고: {self.json_file_path} 파일을 찾을 수 없습니다. 기본 아이템만 사용합니다.")
                self._load_default_items()
        except Exception as e:
            print(f"오류: JSON 파일 로드 실패 - {e}")
            print("기본 아이템 데이터를 사용합니다.")
            self._load_default_items()
    
    def _load_default_items(self):
        """기본 아이템 데이터 (JSON 파일 로드 실패시 백업용)"""
        self._items = {
            0: "없음",
            1: "예언의 손길",
            2: "사무엘의 영혼",
            3: "사무엘의 의식 예복",
            4: "사무엘의 고귀한 지팡이",
            5: "패닉소울"
            # 기본 몇 개만 포함 (전체는 JSON 파일에서 로드)
        }

from typing import Dict


class ItemDatabase:
    """아이템 데이터베이스 클래스"""
    
    def __init__(self):
        self._items: Dict[int, str] = {
            0: "없음",
            1: "예언의 손길",
            2: "사무엘의 영혼",
            3: "사무엘의 의식 예복",
            4: "사무엘의 고귀한 지팡이",
            5: "패닉소울",
            6: "야휘림의 영혼",
            7: "풍마반지",
            8: "풍신권법",
            9: "색마의 풀어헤쳐진 청천의",
            10: "마천율의 영혼",
            11: "광천검법",
            12: "광마의 칠흑도포",
            13: "청혈주",
            14: "을령의 영혼",
            15: "을령의 정돈된 백옥신의",
            16: "혈마의 반지",
            17: "수라멸마장",
            18: "체프의 영혼",
            19: "체프의 빛나는 장갑",
            20: "체프의 구겨진 천옷",
            21: "체프의 작은구체",
            22: "에누크의 영혼",
            23: "에누크의 끈장갑",
            24: "에누크의 용문양 훈도시",
            25: "에누크의 강철부메랑",
            26: "모나크의 영혼",
            27: "모나크의 위협적인 갑주",
            28: "모나크의 마그넷블레이드",
            29: "모나크의 가죽장갑",
            30: "위트겡의 영혼",
            31: "위트겡의 찢겨진 손",
            32: "위트겡의 허물어버린 손톱",
            33: "위트겡의 낡아버린 가죽",
            34: "용암지옥거미의 영혼",
            35: "용암지옥거미의 화염",
            36: "용암지옥거미의 뾰족한 다리",
            37: "용암지옥거미의 탄탄한 껍질",
            38: "포악한자의 미약한 무력",
            39: "포악한자의 미약한 영혼",
            40: "포악한자의 미약한 요력",
            41: "포악한자의 미약한 사력",
            42: "카마엘의 영혼",
            43: "파괴의 갑옷",
            44: "파괴의 장갑",
            45: "파괴의검",
            46: "데스펄엑스",
            47: "죽음의 손길",
            48: "아즈라엘의 영혼",
            49: "아즈라엘의 사슬갑옷",
            50: "카인의 견고한 팔목대",
            51: "카인의 배신의 대검",
            52: "카인의 브론즈 플레이트",
            53: "카인의 영혼",
            54: "Go To Hell !!!!!!!",
            55: "루드비아나의 약혼반지",
            56: "파워즈의 쇠도끼",
            57: "악마삼총사의 지령서 Go",
            58: "악마삼총사의 지령서 Hell",
            59: "악마삼총사의 지령서 To",
            60: "슈나이더를 쓰러트린자",
            61: "루시퍼의 계약서",
            62: "루시퍼의 권속",
            63: "루시퍼의 인정",
            64: "루시퍼의 축복",
            65: "하늘이 되고 싶었던 자 [강력]",
            66: "하늘이 되고 싶었던 자 [강인]",
            67: "하늘이 되고 싶었던 자 [전능]",
            68: "로망 Of 아즈라엘 [강력]",
            69: "로망 Of 아즈라엘 [강인]",
            70: "로망 Of 아즈라엘 [전능]",
            71: "그레모리의 오래된 목걸이",
            72: "전쟁",
            73: "투신의 기운",
            74: "위대한 공작의 타오르는 둔기",
            75: "구시온의 영혼",
            76: "구시온의 값비싼 갑주",
            77: "분노의 갑주",
            78: "사타니스",
            79: "베리알의 영혼",
            80: "그레모리의 소중한 목걸이",
            81: "위리놈의 라이벌",
            82: "전쟁의 슬픔",
            83: "§펜타그램§ - [그레모리]",
            84: "§펜타그램§ - [에리고스]",
            85: "§펜타그램§ - [오세]",
            86: "태뢰진갑",
            87: "암살용 가죽 장갑",
            88: "파이몬의 영혼",
            89: "진:태뢰진갑",
            90: "진:암살용 가죽 장갑",
            91: "진:파이몬의 영혼",
            92: "교만의 태뢰진갑",
            93: "교만의 암살용 가죽 장갑",
            94: "슬픈 영혼의 파이몬",
            95: "탐욕의 마력",
            96: "어비스 of 시타엘 [강력]",
            97: "어비스 of 시타엘 [강인]",
            98: "어비스 of 시타엘 [전능]",
            99: "질투의 마력",
            100: "아벨의 고통 [강력]",
            101: "아벨의 고통 [강인]",
            102: "아벨의 고통 [전능]",
            103: "음욕의 마력",
            104: "디스트럭티브",
            105: "몰로크의 영혼",
            106: "질긴 철가죽",
            107: "블레이즈 블레이드",
            108: "사타나키아의 영혼",
            109: "어긋나버린 형제의 레지스트",
            110: "리리스의 검은 날개 옷",
            111: "리리스의 마신구",
            112: "리리스의 영혼",
            113: "강력의 마신석",
            114: "강인의 마신석",
            115: "전능의 마신석",
            116: "나태의 마력",
            117: "디스트럭티브",
            118: "프라이드소울",
            119: "다크매터",
            120: "가디스 폴른",
            121: "데스티니 사이드",
            122: "마궁 샤르베",
            123: "브레이크 블레이드",
            124: "블라드 네클레스",
            125: "아슈켈론",
            126: "제람불뤼트",
            127: "제블나인",
            128: "합쳐진 아담과 리리스의 마신구",
            129: "티르빙",
            130: "베리알의 권속기",
            131: "사탄의 힘을 내는 자",
            132: "죽음을 부정하는 자",
            133: "제블나인 서열 7위",
            134: "잔혹한 인연",
            135: "악령공주의 영혼",
            136: "파괴신 [강력]",
            137: "파괴신 [강인]",
            138: "파괴신 [전능]",
            139: "블레이즈 블레이드[모조품]",
            140: "불완전한 플뤼톤의 영혼",
            141: "이프리트의 영혼",
            142: "흑암의 영혼갑주",
            143: "불완전한 흑염의 영혼갑주",
            144: "데빌테스트",
            145: "그람다이트",
            146: "디스트럭티브",
            147: "완전한 플뤼톤의 영혼",
            148: "완전한 플뤼톤의 영혼갑주",
            149: "단탈리온의 영혼",
            150: "더블잭나이프",
            151: "안드레알푸스의 가죽팬티",
            152: "안드레알푸스의 강철채찍",
            153: "안드레알푸스의 영혼",
            154: "자간의 영혼",
            155: "자간의 푸른 영혼의 갑주",
            156: "자간의 푸른구체",
            157: "후엠아이",
            158: "화신 [강력]",
            159: "화신 [강인]",
            160: "화신 [전능]",
            161: "대마신 [강력]",
            162: "대마신 [강인]",
            163: "대마신 [전능]",
            164: "태초의 무력",
            165: "델모크의 영혼",
            166: "불이 모여드는 자",
            167: "악령이 모여드는 자",
            168: "지옥의 어머니",
            169: "위리놈의 대적자",
            170: "최초의 살인자",
            172: "레바테인",
            173: "옥마혈도",
            174: "예궁 피나카",
            175: "지옥묵시록",
            176: "아몬의 아귀혈복",
            177: "아몬의 지옥신의",
            178: "아몬의 패천투갑",
            179: "아몬의 강력한 영혼",
            180: "아몬의 강인한 영혼",
            181: "아몬의 전능한 영혼",
            182: "태초의 마신 [강력]",
            183: "태초의 마신 [강인]",
            184: "태초의 마신 [전능]",
            185: "사탄의 근원",
            186: "강자멸시",
            187: "선악과",
            188: "죽음의 낙인",
            189: "신기루",
            190: "뱀페러가 건네준 심장덩어리",
            191: "교만의 마력",
            192: "분노의 마력",
            193: "폭식의 마력",
            194: "종말의 뿔피리",
            195: "마황의 마신석",
            196: "크리스마스의 재림 [1단계]",
            197: "크리스마스의 재림 [2단계]",
            198: "크리스마스의 재림 [3단계]",
            199: "크리스마스의 재림 [4단계]",
            200: "크리스마스의 재림 [5단계]",
            201: "크리스마스의 재림 [6단계]",
            202: "완전한 크리스마스의 재림 [강력]",
            203: "완전한 크리스마스의 재림 [강인]",
            204: "완전한 크리스마스의 재림 [전능]",
            205: "검붉게 정화된 지옥문",
            206: "영겁을 머금은 지옥문",
            207: "하얗게 침식된 지옥문",
            208: "묵시록의 강력한 영혼",
            209: "묵시록의 강인한 영혼",
            210: "묵시록의 전능한 영혼",
            211: "죄:가디스폴른",
            212: "죄:그람다이트",
            213: "죄:데스티니 사이드",
            214: "죄:낙인",
            215: "죄:레바테인",
            216: "죄:마황의 마신석",
            217: "죄:브레이크 블레이드",
            218: "죄:블라드 네클레스",
            219: "죄:샤르베",
            220: "죄:신기루",
            221: "죄:아슈켈론",
            222: "죄:에덴의 결정구",
            223: "죄:옥마혈도",
            224: "죄:제람불뤼트",
            225: "죄:제블나인",
            226: "죄:종말의 뿔피리",
            227: "죄:진조의 심장",
            228: "죄:티르빙",
            229: "죄:피나카",
            230: "죄:지옥묵시록",
            231: "죄:인과율의 수레바퀴",
            232: "오망성의 샛별",
            233: "죄:오망성의 눈물",
            234: "데빌엔드",
            235: "죄:데빌엔드",
            236: "라파엘의 강인한 영혼",
            237: "라파엘의 강력한 영혼",
            238: "라파엘의 전능한 영혼",
            239: "희망과 절망의 대천사 [강인]",
            240: "희망과 절망의 대천사 [강력]",
            241: "희망과 절망의 대천사 [전능]",
            242: "죄:붉은 밤",
            243: "죄:디아블로의 심장",
            244: "죄:아르스 게티아",
            245: "가브리엘의 강인한 영혼",
            246: "가브리엘의 강력한 영혼",
            247: "가브리엘의 전능한 영혼",
            248: "어두운 자들의 유혹",
            249: "풀려나버린 죄의 원죄",
            250: "최초의 금지된 성서",
            251: "죄의 원죄",
            252: "몰려드는 어두운 자들의 유혹",
            253: "금지된 성서",
            254: "영원의 밤",
            255: "죄:영원의 밤",
            256: "몰려드는 어두운 자들의 유혹",
            257: "절망 황녀의 피눈물",
            258: "죄:절망",
            259: "아포칼립스",
            260: "죄:아포칼립스",
            261: "혼돈",
            262: "죄:혼돈",
            263: "무거운 죄의 십자가",
            264: "거대한 죄의 십자가",
            265: "육신을 짓이기는 월계관",
            266: "영혼을 짓이기는 월계관",
            267: "재앙을 부르는 피의 잔",
            268: "멸망을 부르는 피의 잔",
            269: "우리엘의 강인한 영혼",
            270: "심판하는자의 강인한 영혼",
            271: "우리엘의 강력한 영혼",
            272: "심판하는자의 강력한 영혼",
            273: "우리엘의 전능한 영혼",
            274: "심판하는자의 전능한 영혼",
            275: "파괴검 - 누야",
            276: "죄:누야",
            277: "천마신검",
            278: "죄:천마신검",
            279: "이클립스",
            280: "죄:이클립스",
            281: "아카식 레코드"
        }
    
    def get_item_name(self, item_id: int) -> str:
        """아이템 ID로 아이템 이름 조회"""
        return self._items.get(item_id, f"알 수 없는 아이템({item_id})")
    
    def get_item_code_by_name(self, item_name: str) -> int:
        """아이템 이름으로 아이템 코드(ID) 조회"""
        for item_id, name in self._items.items():
            if name == item_name:
                return item_id
        return None
    
    def get_all_items(self) -> Dict[int, str]:
        """모든 아이템 정보 반환"""
        return self._items.copy()
    
    def search_items(self, keyword: str) -> Dict[int, str]:
        """키워드로 아이템 검색"""
        result = {}
        keyword = keyword.lower()
        for item_id, item_name in self._items.items():
            if keyword in item_name.lower():
                result[item_id] = item_name
        return result
    
    def reload_items(self):
        """JSON 파일에서 아이템 데이터 다시 로드"""
        print("아이템 데이터를 다시 로드합니다...")
        self._load_items_from_json()
    
    def save_items_to_json(self, new_items: Dict[int, str] = None):
        """현재 아이템 데이터를 JSON 파일에 저장"""
        if new_items:
            self._items.update(new_items)
        
        try:
            # 정수 키를 문자열로 변환
            items_json = {str(k): v for k, v in self._items.items()}
            
            with open(self.json_file_path, 'w', encoding='utf-8') as f:
                json.dump(items_json, f, ensure_ascii=False, indent=2)
            
            print(f"아이템 {len(self._items)}개가 {self.json_file_path}에 저장되었습니다.")
            return True
        except Exception as e:
            print(f"오류: JSON 파일 저장 실패 - {e}")
            return False
    
    def add_item(self, item_id: int, item_name: str, save_to_file: bool = True):
        """새 아이템 추가"""
        self._items[item_id] = item_name
        if save_to_file:
            self.save_items_to_json()
        print(f"아이템 추가됨: {item_id} - {item_name}")
    
    def get_item_count(self) -> int:
        """총 아이템 개수 반환"""
        return len(self._items)
